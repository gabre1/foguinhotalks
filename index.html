<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foguinho Talks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg {
            background: url('https://i.imgur.com/604L1DQ.jpeg') center/cover no-repeat;
            position: relative;
            transition: background-image 0.05s ease-in-out;
        }
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }
        .generate-btn, .copy-btn {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            transition: all 0.3s ease;
        }
        .generate-btn:hover, .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(75, 85, 99, 0.3);
        }
        .text-shadow-lg { text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8); }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="relative z-10 min-h-screen flex flex-col justify-between">
        <div class="pt-8 pb-4">
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="generateBtn" class="generate-btn text-white font-semibold py-4 px-8 rounded-xl shadow-lg text-xl">
                    Gerar
                </button>
                <button id="downloadBtn" class="copy-btn text-white font-semibold py-4 px-8 rounded-xl shadow-lg opacity-50 cursor-not-allowed text-xl" disabled>
                    Baixar
                </button>
            </div>
        </div>
        
        <div class="pb-8">
            <div class="text-center max-w-4xl mx-auto px-4">
                <div id="phraseDisplay" class="min-h-[200px] flex items-center justify-center text-shadow-lg max-w-md mx-auto" style="font-family: Tahoma, sans-serif; font-size: 35px; color: #ffe169; font-style: italic; word-wrap: break-word; hyphens: auto; line-height: 1.4;">
                    <span class="opacity-80">...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const templates = [ "vou smokar o [animal] pra tu", "esse [animal] é [adjective]", "só porque eu sou [adjective], [adjective] e [adjective]", "tu sabe mexer no [animal]?", "esse [adjective] nem falou comigo na [location]", "se me chamar pra [verb] eu vou", "vamo pro show do [animal] [location]", "to sempre com vontade de [verb]", "cala boca [adjective]!", "vou comer [animal] pra tirar o gosto ruim da boca", "tem figurinha de [adjective] aí", "to no vaso botando o [animal] pra fora", "eu vi um vulto [location]" ];
        const animals = [ "coreldraw", "cuscuz", "disney", "mirinha", "coroa", "bruninho", "suco de salsicha", "bioma", "leitinho", "cocô", "cu do wilson", "metal", "cuscuz fresco", "salsicha perdigão" ];
        const adjectives = [ "lixoso", "abominação", "aberração", "vagabundo", "vadia", "energumeno", "antipatico", "fogoso", "inchado", "atleta", "preto", "periférico", "pobre", "baba ovo", "mole", "troglodita", "primata", "obeso", "lgbt" ];
        const verbs = [ "meter", "fuder", "cagar", "beijar", "trepar", "amar", "mijar", "tocar", "mamar", "chorar", "comer", "chupar", "jogar", "farmar" ];
        const locations = [ "em recife", "no marco zero", "aqui", "na casa do rafa", "na amelia rosa", "no kfofo", "no archeage", "no show do angra", "na casa da minha tia", "no ano novo", "na na casa vieira", "no coreldraw", "na casa do yu", "na delegacia", "no sao januario", "no priston tale", "na rua", "na familia runaway", "no show do alexisonfire cover", "na lan house do gordo", "no rf online" ];

        const BACKGROUND_CLOSED_MOUTH = 'https://i.imgur.com/604L1DQ.jpeg';
        const BACKGROUND_OPEN_MOUTH = 'https://i.imgur.com/ShsY5Us.png';
        let currentPhrase = '';
        let animationInterval;
        let isMouthOpen = false;
        let currentAudio = null;

        function getRandomItem(array) { return array[Math.floor(Math.random() * array.length)]; }
        function getRandomNumber(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

        function toggleMouthImage() {
            document.body.style.backgroundImage = `url('${isMouthOpen ? BACKGROUND_CLOSED_MOUTH : BACKGROUND_OPEN_MOUTH}')`;
            isMouthOpen = !isMouthOpen;
        }
        function startMouthAnimation() {
            if (animationInterval) clearInterval(animationInterval);
            animationInterval = setInterval(toggleMouthImage, 100);
        }
        function stopMouthAnimation() {
            clearInterval(animationInterval);
            document.body.style.backgroundImage = `url('${BACKGROUND_CLOSED_MOUTH}')`;
            isMouthOpen = false;
        }

        async function speakPhrase(phrase) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            
            const url = '/api';
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: phrase })
                });

                if (!response.ok) { throw new Error(`Erro do servidor: ${response.statusText}`); }

                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);
                currentAudio = new Audio(audioUrl);
                
                currentAudio.onplay = startMouthAnimation;
                currentAudio.onended = () => {
                    stopMouthAnimation();
                    generateBtn.disabled = false;
                    generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                };
                currentAudio.onerror = () => {
                    console.error("Erro ao tocar o áudio.");
                    stopMouthAnimation();
                    generateBtn.disabled = false;
                    generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                };
                currentAudio.play();
            } catch (error) {
                console.error('Falha ao gerar o áudio:', error);
                alert('Não foi possível gerar a voz. Verifique o console para mais detalhes.');
                stopMouthAnimation();
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function generatePhrase() {
            let template = getRandomItem(templates);
            let phrase = template.replace(/\{(\d+)-(\d+)\}/g, (match, min, max) => getRandomNumber(parseInt(min), parseInt(max)))
                                 .replace(/\[animal\]/g, () => getRandomItem(animals))
                                 .replace(/\[adjective\]/g, () => getRandomItem(adjectives))
                                 .replace(/\[verb\]/g, () => getRandomItem(verbs))
                                 .replace(/\[location\]/g, () => getRandomItem(locations))
                                 .replace(/\{s\}/g, 's');
            return phrase;
        }

        function displayPhrase(phrase) {
            const display = document.getElementById('phraseDisplay');
            display.innerHTML = `<span class="fade-in">${phrase}</span>`;
            speakPhrase(phrase);
            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.disabled = false;
            downloadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        
        
        function downloadImage() {
            if (!currentPhrase) return;
            stopMouthAnimation();
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 800; canvas.height = 600;
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.src = BACKGROUND_CLOSED_MOUTH;
            img.onload = function() {
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.font = 'italic 35px Tahoma, sans-serif';
                ctx.fillStyle = '#ffe169';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                ctx.shadowBlur = 8;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                function wrapText(text, x, y, maxWidth, lineHeight) {
                    const words = text.split(' ');
                    let line = '';
                    let lines = [];
                    for (let n = 0; n < words.length; n++) {
                        const testLine = line + words[n] + ' ';
                        const metrics = ctx.measureText(testLine);
                        if (metrics.width > maxWidth && n > 0) {
                            lines.push(line);
                            line = words[n] + ' ';
                        } else {
                            line = testLine;
                        }
                    }
                    lines.push(line);
                    const startY = y - ((lines.length - 1) * lineHeight) / 2;
                    for (let i = 0; i < lines.length; i++) {
                        ctx.fillText(lines[i], x, startY + (i * lineHeight));
                    }
                }
                wrapText(currentPhrase, canvas.width / 2, canvas.height / 2, canvas.width - 100, 50);
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'frase-aleatoria.jpg';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 'image/jpeg', 0.9);
            };
        }

        document.getElementById('generateBtn').addEventListener('click', () => {
            currentPhrase = generatePhrase();
            displayPhrase(currentPhrase);
        });
        document.getElementById('downloadBtn').addEventListener('click', downloadImage);
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                document.getElementById('generateBtn').click();
            }
        });
    </script>
</body>


</html>
